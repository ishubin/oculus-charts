/*******************************************************************************
 * Copyright 2012 Ivan Shubin http://mindengine.net
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *******************************************************************************/
OculusObject=new Object;OculusObject.addAll=function(a){for(var b in a){this[b]=a[b]}};OculusObject.extend=function(){var a=new Object;a.addAll=OculusObject.addAll;a.addAll(this);return a};OculusObject.create=function(){return this.extend()};var OculusChartUtils={getMousePosition:function(a){var b=0;var c=0;if(!a)var a=window.event;if(a.pageX||a.pageY){b=a.pageX;c=a.pageY}else if(a.clientX||a.clientY){b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop}return{x:b,y:c}},getElementPosition:function(a){var b=0;var c=0;if(a){obj=a;if(obj.offsetParent){do{b+=obj.offsetLeft;c+=obj.offsetTop}while(obj=obj.offsetParent)}}return{x:b,y:c}}};Date.prototype.format=function(a){var b="";var c=Date.replaceChars;for(var d=0;d<a.length;d++){var e=a.charAt(d);if(d-1>=0&&a.charAt(d-1)=="\\"){b+=e}else if(c[e]){b+=c[e].call(this)}else if(e!="\\"){b+=e}}return b};Date.replaceChars={shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d:function(){return(this.getDate()<10?"0":"")+this.getDate()},D:function(){return Date.replaceChars.shortDays[this.getDay()]},j:function(){return this.getDate()},l:function(){return Date.replaceChars.longDays[this.getDay()]},N:function(){return this.getDay()+1},S:function(){return this.getDate()%10==1&&this.getDate()!=11?"st":this.getDate()%10==2&&this.getDate()!=12?"nd":this.getDate()%10==3&&this.getDate()!=13?"rd":"th"},w:function(){return this.getDay()},z:function(){var a=new Date(this.getFullYear(),0,1);return Math.ceil((this-a)/864e5)},W:function(){var a=new Date(this.getFullYear(),0,1);return Math.ceil(((this-a)/864e5+a.getDay()+1)/7)},F:function(){return Date.replaceChars.longMonths[this.getMonth()]},m:function(){return(this.getMonth()<9?"0":"")+(this.getMonth()+1)},M:function(){return Date.replaceChars.shortMonths[this.getMonth()]},n:function(){return this.getMonth()+1},t:function(){var a=new Date;return(new Date(a.getFullYear(),a.getMonth(),0)).getDate()},L:function(){var a=this.getFullYear();return a%400==0||a%100!=0&&a%4==0},o:function(){var a=new Date(this.valueOf());a.setDate(a.getDate()-(this.getDay()+6)%7+3);return a.getFullYear()},Y:function(){return this.getFullYear()},y:function(){return(""+this.getFullYear()).substr(2)},a:function(){return this.getHours()<12?"am":"pm"},A:function(){return this.getHours()<12?"AM":"PM"},B:function(){return Math.floor(((this.getUTCHours()+1)%24+this.getUTCMinutes()/60+this.getUTCSeconds()/3600)*1e3/24)},g:function(){return this.getHours()%12||12},G:function(){return this.getHours()},h:function(){return((this.getHours()%12||12)<10?"0":"")+(this.getHours()%12||12)},H:function(){return(this.getHours()<10?"0":"")+this.getHours()},i:function(){return(this.getMinutes()<10?"0":"")+this.getMinutes()},s:function(){return(this.getSeconds()<10?"0":"")+this.getSeconds()},u:function(){var a=this.getMilliseconds();return(a<10?"00":a<100?"0":"")+a},e:function(){return"Not Yet Supported"},I:function(){return"Not Yet Supported"},O:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+"00"},P:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+":00"},T:function(){var a=this.getMonth();this.setMonth(0);var b=this.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,"$1");this.setMonth(a);return b},Z:function(){return-this.getTimezoneOffset()*60},c:function(){return this.format("Y-m-d\\TH:i:sP")},r:function(){return this.toString()},U:function(){return this.getTime()/1e3}};Math.log10=function(a){return Math.log(a)/Math.LN10};var Rect=OculusObject.extend();Rect.addAll({create:function(a,b,c,d){var e=this.extend();e.left=a;e.top=b;e.right=c;e.bottom=d;return e},getWidth:function(){return this.right-this.left},getHeight:function(){return this.bottom-this.top},isIn:function(a){if(a.x>=this.left&&a.x<=this.right&&a.y>=this.top&&a.y<=this.bottom){return true}return false}});var OculusAxis=OculusObject.extend();OculusAxis.addAll({create:function(a,b,c){var d=OculusAxis.extend();if(a!=null){d.type=a}else d.type="number";if(b!=null){d.steps=b}if(c!=null){d.range=c}else d.range=[0,10];d.name="Undefined";d.unit="u";d.steps=1;d.labels=[];d.dateFormat="j.m.Y G:i:s";return d},calculateOptimalSteps:function(a,b){if(this.type!="label"){return Math.round(a/b)}else return this.labels.length-1},getLabelText:function(a){if(this.type=="date"){a=Math.round(a);var b=new Date(a);return""+b.format(this.dateFormat)}else if(this.type=="number"||this.type=="float"){if(a!=0){var c=Math.round(Math.log10(Math.abs(this.range[1]-this.range[0])));if(c>3){return""+Math.round(a)}else{if(c>-4){var d=4-c;var e=Math.pow(10,d);return""+Math.round(a*e)/e}else return""+a.toExponential(3)}}else return"0"}else if(this.type=="label"){return this.labels[Math.round(a)]}else return""+a}});var OculusGrid=OculusObject.extend();OculusGrid.addAll({create:function(){var a=OculusGrid.extend();a.rect=Rect.create();a.axis={x:OculusAxis.create("number",1,[0,10]),y:OculusAxis.create("number",1,[0,10])};a.settings={rect:{on:true,color:"#ffffff",opacity:.2,background:"#888888",strokeWidth:2},text:{color:"white",fontSize:15,axis:{color:"white",fontSize:12}},axis:{x:{lines:{on:true,color:"#444444",strokeWidth:1,strokeDash:". "},labels:{compactForm:true}},y:{lines:{on:true,color:"#444444",strokeWidth:1,strokeDash:". "}}}};return a},setRect:function(a,b,c,d){this.rect.top=b;this.rect.left=a;this.rect.bottom=d;this.rect.right=c},getRect:function(){return this.rect},setAxisRange:function(a,b,c,d){this.axis.x.range=[a,b];this.axis.y.range=[c,d]},calculateOptimalSteps:function(a,b){if(a==null){a=50}if(b==null)b=a;if(a>0&&b>0){this.axis.x.steps=this.axis.x.calculateOptimalSteps(this.rect.getWidth(),a);this.axis.y.steps=this.axis.y.calculateOptimalSteps(this.rect.getHeight(),b)}},translateToScreen:function(a,b){if(this.axis.x.type=="label"){this.axis.x.range=[0,this.axis.x.labels.length-1]}if(this.axis.y.type=="label"){this.axis.y.range=[0,this.axis.y.labels.length-1]}var c,d,e,f;c=(this.rect.right-this.rect.left)/(this.axis.x.range[1]-this.axis.x.range[0]);d=this.rect.left-c*this.axis.x.range[0];e=(this.rect.top-this.rect.bottom)/(this.axis.y.range[1]-this.axis.y.range[0]);f=this.rect.bottom-e*this.axis.y.range[0];var g=Math.round(c*a+d);var h=Math.round(e*b+f);return{x:g,y:h}},drawGrid:function(){var a=this.raphael;if(this.settings.rect.on){var b=this.settings.rect;a.rect(this.rect.left,this.rect.top,this.rect.getWidth(),this.rect.getHeight()).attr({stroke:b.color,"stroke-width":b.strokeWidth,fill:b.background,opacity:b.opacity})}this.calculateOptimalSteps();if(this.settings.axis.x.lines.on&&this.axis.x.steps>0){var c=this.settings.axis.x.lines;var d=this.rect.getWidth()/this.axis.x.steps;for(var e=1;e<this.axis.x.steps;e++){var f=Math.round(e*d)+this.rect.left;a.path("M"+f+" "+this.rect.top+"L"+f+" "+this.rect.bottom).attr({stroke:c.color,"stroke-dasharray":c.strokeDash,"stroke-width":c.strokeWidth})}var g=(this.axis.x.range[1]-this.axis.x.range[0])/this.axis.x.steps;for(var e=0;e<this.axis.x.steps+1;e++){var h=null;if(this.axis.x.type!="label"){h=this.axis.x.getLabelText(e*g+this.axis.x.range[0])}else h=this.axis.x.getLabelText(e);var f=Math.round(e*d)+this.rect.left;var i=this.settings.text.axis;var j=a.text(f+10,this.rect.bottom+i.fontSize,""+h).attr({"text-anchor":"start",stroke:"none",fill:i.color,"font-size":i.fontSize});if(this.settings.axis.x.labels.compactForm==true){j.attr({rotation:"-45 "+f+" "+this.rect.bottom,translation:"0,10","text-anchor":"end"})}}}if(this.axis.x.name!=null){var k=this.axis.x.name;if(this.axis.x.unit!=null){k+=" ("+this.axis.x.unit+")"}a.text(this.rect.right,this.rect.top-20,""+k).attr({"text-anchor":"end",stroke:"none",fill:this.settings.text.color,"font-size":this.settings.text.fontSize})}if(this.settings.axis.y.lines.on&&this.axis.y.steps>0){var l=this.settings.axis.y.lines;var d=this.rect.getHeight()/this.axis.y.steps;for(var e=1;e<this.axis.y.steps;e++){var m=Math.round(e*d)+this.rect.top;a.path("M"+this.rect.left+" "+m+"L"+this.rect.right+" "+m).attr({stroke:l.color,"stroke-dasharray":l.strokeDash,"stroke-width":l.strokeWidth})}var n=(this.axis.y.range[1]-this.axis.y.range[0])/this.axis.y.steps;for(var e=0;e<this.axis.y.steps+1;e++){var h=null;if(this.axis.y.type!="label"){h=this.axis.y.getLabelText(this.axis.y.range[1]-e*n)}else h=this.axis.y.getLabelText(e);var m=Math.round(e*d)+this.rect.top;var i=this.settings.text.axis;a.text(this.rect.left-i.fontSize,m,h).attr({"text-anchor":"end",stroke:"none",fill:i.color,"font-size":i.fontSize})}}if(this.axis.y.name!=null){var k=this.axis.y.name;if(this.axis.y.unit!=null){k+=" ("+this.axis.y.unit+")"}a.text(this.rect.left-90,Math.round((this.rect.bottom-this.rect.top)/2),""+k).attr({rotation:"-90",stroke:"none",fill:this.settings.text.color,"font-size":this.settings.text.fontSize})}}});var OculusChart=OculusObject.extend();OculusChart.addAll({create:function(a,b,c){var d=this.extend();d.name="Undefined chart";d.grid=OculusGrid.create();d.settings={textColor:"white",chartHeader:{fontSize:15,fontWeight:"bold"},hint:{fontSize:12,fontColor:"white",fontLabelColor:"#5555ff",background:"black",strokeColor:"#d0d0d0",strokeWidth:3}};d.rect=Rect.create(0,0,b,c);d.changeGridRect(b,c);d.raphael=Raphael(a,b,c);d.plot=document.getElementById(a);return d},changeGridRect:function(a,b){var c=0,d=0,e=0,f=0;var g=this.rect.top+this.settings.chartHeader.fontSize;d=g+this.settings.chartHeader.fontSize+20;c=this.rect.left+120;e=this.rect.right-20;f=this.rect.bottom-100;this.grid.setRect(c,d,e,f)},drawLoadingIcon:function(){if(this.loadingIconTimer!=null){this.stopLoadingIcon()}var a=this.raphael;var b=Math.round(this.getRect().getWidth()/2);var c=Math.round(this.getRect().getHeight()/2);var d=Math.min(this.getRect().getWidth(),this.getRect().getHeight());var e=d/6;var f=30;var g=8;var h=0;var i,j,k,l;var m=a.set();for(var n=0;n<g;n++){h=Math.PI*2*n/g;i=b+Math.round(f*Math.cos(h));j=c+Math.round(f*Math.sin(h));k=b+Math.round(e*Math.cos(h));l=c+Math.round(e*Math.sin(h));this.loadingIconSet=m.push(a.path("M"+i+","+j+" L"+k+","+l).attr({stroke:"white","stroke-width":8,opacity:.6*(n+1)/g}))}var h=0;var o=360/g;m.rotate(0,b,c);this.loadingIconTimer=setInterval(function(){h+=o;m.rotate(h,b,c)},50)},stopLoadingIcon:function(){if(this.loadingIconTimer!=null){clearInterval(this.loadingIconTimer);this.loadingIconTimer=null;this.loadingIconSet.remove()}},setRect:function(a,b,c,d){this.rect.top=b;this.rect.left=a;this.rect.bottom=d;this.rect.right=c},getRect:function(){return this.rect},drawChart:function(){var a=this.raphael;var b=Math.round((this.rect.right-this.rect.left)/2);var c=this.rect.top+this.settings.chartHeader.fontSize;a.text(b,c,this.name).attr({stroke:"none","text-anchor":"middle",fill:this.settings.textColor,"font-size":this.settings.chartHeader.fontSize,"font-weight":this.settings.chartHeader.fontWeight});this.grid.raphael=this.raphael;if(this.grid!=null){this.grid.drawGrid()}},getHintType:function(a,b){var c=this.grid.translateToScreen(a,b);var d=0;var e=Math.round(this.grid.rect.left+this.grid.rect.getWidth()/2);var f=Math.round(this.grid.rect.top+this.grid.rect.getHeight()/2);if(c.x>e&&c.y<f)d=1;else if(c.x<e&&c.y>f)d=2;if(c.x>e&&c.y>f)d=3;return d},drawHint:function(a,b,c,d,e){var f=this.raphael;var g=this.grid.translateToScreen(a,b);var h=this.getHintType(a,b);var i=this.grid.axis.y.getLabelText(b);var j=this.grid.axis.x.getLabelText(a);if(this.grid.axis.y.unit!=null&&this.grid.axis.y.unit!=""){i+=" "+this.grid.axis.y.unit}if(this.grid.axis.x.unit!=null&&this.grid.axis.x.unit!=""){j+=" "+this.grid.axis.x.unit}var k=Math.max(i.length,j.length);var l=1,m=1;if(h==0){l=1;m=1}else if(h==1){l=-1;m=1}else if(h==2){l=1;m=-1}else if(h==3){l=-1;m=-1}var n=this.settings.hint.fontSize;var o=20,p=10;var q=g.x+p*l+n;var r=Math.round(g.y+p*m+n/2)+n;var s=this.settings.hint;var t=[f.text(q,r,c).attr({stroke:"none",fill:d,"font-weight":"bold","font-size":n,"text-anchor":"start"}),f.text(q,r+n+2,"Y:").attr({stroke:"none",fill:s.fontLabelColor,"font-weight":"bold","font-size":n,"text-anchor":"start"}),f.text(q+n+5,r+n+2,i).attr({stroke:"none",fill:s.fontColor,"font-size":n,"text-anchor":"start"}),f.text(q,r+2*(n+2),"X:").attr({stroke:"none",fill:s.fontLabelColor,"font-weight":"bold","font-size":n,"text-anchor":"start"}),f.text(q+n+5,r+2*(n+2),j).attr({stroke:"none",fill:s.fontColor,"font-size":n,"text-anchor":"start"})];if(e!=null&&e!=""){t.push(f.text(q+n+5,r+3*(n+2),e).attr({stroke:"none",fill:s.fontColor,"font-size":n,"text-anchor":"start"}))}var u=f.set();for(var v=0;v<t.length;v++){u.push(t[v])}var w=u.getBBox();var x=w.width+n*2;var y=w.height+n*2;var z=[[0,0],[o*l,p*m],[(p+x)*l,p*m],[(p+x)*l,(p+y)*m],[p*l,(p+y)*m],[p*l,o*m],[0,0]];var A="M";for(var v=0;v<z.length;v++){if(v>0)A+="L";A+=z[v][0]+" "+z[v][1]}var B=f.set();B.push(f.path(A).attr({translation:g.x+","+g.y,stroke:s.strokeColor,"stroke-width":s.strokeWidth,fill:s.background}));u.toFront();if(l<0)u.translate(-x,0);if(m<0)u.translate(0,-y);B.push(u);return B},redraw:function(a){var b=this.raphael;b.clear();if(a!=null){this.raphael=a}this.drawChart()}});var OculusLineChart=OculusChart.extend();OculusLineChart.addAll({super_create:OculusChart.create,create:function(a,b,c){var d=this.super_create(a,b,c);d.settings.line={fill:false,glow:false};return d},super_drawChart:OculusChart.drawChart,drawChart:function(){this.super_drawChart();var a=null;var b=[];var c=this.grid;this.plot.onmousemove=function(d){var e=OculusChartUtils.getMousePosition(d);var f=OculusChartUtils.getElementPosition(this);e.x=e.x-f.x;e.y=e.y-f.y;if(c.rect.isIn(e)){var g=null;var h=1e10;for(var i=b.length-1;i>=0;i--){var j=b[i];var k=(j.x-e.x)*(j.x-e.x)+(j.y-e.y)*(j.y-e.y);if(h>k){h=k;g=j}}if(g!=a){if(a!=null){a.onout()}a=g;g.onover()}}else if(a!=null){a.onout();a=null}};var d=this.raphael;if(this.chartData!=null){var e=this.chartData.dataset;if(e!=null){for(var f=0;f<e.length;f++){var g=e[f];var h="";var i=null;var j=null;for(var k=0;k<g.data.length;k++){if(k==0){h+="M"}else h+="L";var l=this.grid.translateToScreen(g.data[k].x,g.data[k].y);if(k==0)i=l;if(k==g.data.length-1)j=l;h+=l.x+" "+l.y}var m=d.path(h).attr({stroke:g.color,"stroke-width":2});if(this.settings.line.glow){d.path(h).attr({stroke:g.color,"stroke-width":7,opacity:.2});d.path(h).attr({stroke:g.color,"stroke-width":11,opacity:.1})}if(this.settings.line.fill){h+="L"+j.x+" "+this.grid.rect.bottom+" L"+i.x+" "+this.grid.rect.bottom+" L"+i.x+" "+i.y;d.path(h).attr({fill:g.color,opacity:.2})}var n=this;for(var k=0;k<g.data.length;k++){var l=this.grid.translateToScreen(g.data[k].x,g.data[k].y);b[b.length]={ox:g.data[k].x,oy:g.data[k].y,caption:g.name,color:g.color,hintText:g.data[k].hint,circle:d.circle(l.x,l.y,3).attr({fill:g.color,stroke:"none"}).toFront(),x:l.x,y:l.y,pathLine:m,lineChart:this,onover:function(){if(this.hint==null){this.hint=n.drawHint(this.ox,this.oy,this.caption,this.color,this.hintText).attr({opacity:0})}this.pathLine.toFront();this.hint.toFront().animate({"fill-opacity":.8,opacity:1},500,">");this.circle.animate({r:10,opacity:.6},500,"bounce");this.circle.toFront()},onout:function(){this.circle.animate({r:3,opacity:1},500,">");this.hint.remove();this.hint=null}}}}}}}});var OculusBarChart=OculusChart.extend();OculusBarChart.addAll({super_create:OculusChart.create,create:function(a,b,c){var d=this.super_create(a,b,c);d.settings.gloss={on:false,value:.3,color:"#fff"};return d},super_drawChart:OculusChart.drawChart,drawChart:function(){if(this.grid.axis.x.type=="label"){this.grid.axis.x.labels[this.grid.axis.x.labels.length]="";this.grid.axis.x.range=[0,this.grid.axis.x.labels.length-1];this.super_drawChart();var a=this.raphael;if(this.chartData!=null){var b=this.chartData.dataset;if(b!=null){var c=Math.round(this.grid.getRect().getWidth()/(this.grid.axis.x.labels.length*b.length));var d=null;var e=new Array;var f=this.grid;this.plot.onmousemove=function(a){var b=OculusChartUtils.getMousePosition(a);var c=OculusChartUtils.getElementPosition(this);b.x=b.x-c.x;b.y=b.y-c.y;if(f.rect.isIn(b)){var g=null;for(var h=e.length-1;h>=0;h--){var i=e[h];if(b.x>i.rect[0]&&b.x<i.rect[2]&&b.y>i.rect[1]&&b.y<i.rect[3]){g=i;break}}if(g!=d&&g!=null){if(d!=null){d.onout()}d=g;g.onover()}}else if(d!=null){d.onout();d=null}};for(var g=0;g<b.length;g++){var h=b[g];var i=c*g;for(var j=0;j<h.data.length;j++){var k=this.grid.translateToScreen(h.data[j].x,h.data[j].y);var l=this.grid.rect.bottom-k.y;var m=a.set();var n=a.rect(k.x+i,k.y,c,l).attr({stroke:h.color,"stroke-width":1,fill:h.color});m.push(n);var o=null;if(this.settings.gloss.on){o=a.rect(k.x+i+2,k.y+2,c/2,l-2).attr({stroke:"none",fill:this.settings.gloss.color,opacity:this.settings.gloss.value});m.push(o)}var p=this;e[e.length]={ox:h.data[j].x,oy:h.data[j].y,settings:p.settings,hintText:h.data[j].hint,caption:h.name,color:h.color,bar:m,bw:c,offset:i,light:o,rect:[k.x+i,k.y,c+k.x+i,l+k.y],onover:function(){if(this.light!=null){this.light.animate({opacity:0},500,">")}this.bar.animate({"fill-opacity":this.settings.gloss.value},500,">");if(this.hint==null){this.hint=p.drawHint(this.ox,this.oy,this.caption,this.color,this.hintText).attr({translation:Math.round(this.offset+c/2)+",0"})}this.hint.toFront()},onout:function(){if(this.light!=null){this.light.animate({opacity:this.settings.gloss.value},500,">")}this.bar.animate({"fill-opacity":1},500,">");this.hint.remove();this.hint=null}}}}}}}}});var OculusPieChart=OculusChart.extend();OculusPieChart.addAll({super_create:OculusChart.create,create:function(a,b,c){var d=this.super_create(a,b,c);d.settings={line:{width:1,color:"#333"},outterText:{weight:"bold",size:"14px",color:"black",showAlways:false},innerText:{weight:"bold",size:"14px",color:"white",showAlways:false}};return d},drawChart:function(){var a=this.raphael;var b=0;for(var c=0;c<this.chartData.dataset.length;c++){b+=this.chartData.dataset[c].value}if(b!=null&&b>0){var d=Math.round(Math.min(this.getRect().getWidth(),this.getRect().getHeight())/2-50);var e,f;var g=Math.round(this.getRect().getWidth()/2);var h=Math.round(this.getRect().getHeight()/2);var i,j,k,l;e=g+d;f=h;var m=20;k=g+d+m;l=h;var n=0;var o=0;var p=new Object;for(var c=0;c<this.chartData.dataset.length;c++){var q=this.chartData.dataset[c].value;o=2*Math.PI*q/b;var r=n+o/2;n+=o;i=Math.round(d*Math.cos(n)+g);j=Math.round(d*Math.sin(n)+h);var s=Math.round((d+m)*Math.cos(n)+g);var t=Math.round((d+m)*Math.sin(n)+h);var u=0;if(o>Math.PI){u=1}var v="M"+g+","+h+" L"+e+","+f+" A"+d+","+d+" 0 "+u+" 1 "+i+","+j+" z";var w="M"+g+","+h+" L"+k+","+l+" A"+(d+m)+","+(d+m)+" 0 "+u+" 1 "+s+","+t+" z";var x=a.path(v).attr({stroke:this.settings.line.color,"stroke-width":this.settings.line.width,fill:this.chartData.dataset[c].color,"fill-opacity":.7});var y=0;if(this.settings.innerText.showAlways){y=1}var z=a.text(g+Math.round(d*.7*Math.cos(r)),h+Math.round(d*.7*Math.sin(r)),q).attr({stroke:"none",fill:this.settings.innerText.color,"font-weight":this.settings.innerText.weight,"fill-opacity":y,"text-anchor":"middle","font-size":this.settings.innerText.size});var A=0;if(this.settings.outterText.showAlways){A=1}var B=a.text(g+Math.round(d*1.3*Math.cos(r)),h+Math.round(d*1.3*Math.sin(r)),this.chartData.dataset[c].name).attr({stroke:"none",fill:this.settings.outterText.color,"font-weight":this.settings.outterText.weight,"fill-opacity":A,"text-anchor":"middle","font-size":this.settings.outterText.size});var C=a.path(w).attr({stroke:this.settings.line.color,"stroke-width":this.settings.line.width,fill:this.chartData.dataset[c].color,opacity:0}).mouseover(function(){var a=p[this.id];if(a!=null){a.onover()}}).mouseout(function(){var a=p[this.id];if(a!=null){a.onout()}});p[C.id]={settings:this.settings,piece:x,piecePath:v,selectedPath:w,hoverPiece:C,textValue:z,textName:B,onover:function(){this.piece.animate({path:this.selectedPath},"500","bounce");if(!this.settings.innerText.showAlways){this.textValue.animate({"fill-opacity":1},"500",">")}if(!this.settings.outterText.showAlways){this.textName.animate({"fill-opacity":1},"500",">")}},onout:function(){this.piece.animate({path:this.piecePath},"500",">");if(!this.settings.innerText.showAlways){this.textValue.animate({"fill-opacity":0},"500",">")}if(!this.settings.outterText.showAlways){this.textName.animate({"fill-opacity":0},"500",">")}}};e=i;f=j;k=s;l=t}for(gp in p){p[gp].hoverPiece.toFront()}if(this.settings.line.width>0){a.circle(g,h,this.settings.line.width*2).attr({stroke:this.settings.line.color,fill:this.settings.line.color})}}}})